[project]
name = "saccade"
version = "0.1.0"
description = "Saccade: Tracing and observability library for AI agents"
requires-python = ">=3.13"
dependencies = [
    "pydantic>=2.4",
    "python-ulid>=2.4",
]

[project.optional-dependencies]
litellm = ["litellm>=1.0"]
mcp = ["mcp>=1.0"]
all = ["saccade[litellm,mcp]"]

[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.ruff]
line-length = 100
target-version = "py313"
src = ["src"]

[tool.ruff.lint]
select = ["ALL"]
ignore = [
    "D",        # pydocstyle (enable selectively if needed)
    "COM812",   # trailing comma (formatter conflict)
    "ISC001",   # string concat (formatter conflict)
    "ANN401",   # Dynamically typed Any
    "TD002",    # Missing TODO author
    "TD003",    # Missing TODO link
    "FIX002",   # Line contains TODO
]

[tool.ruff.lint.per-file-ignores]
"tests/**/*.py" = [
    "S101",     # assert usage
    "PLR2004",  # magic values
    "ANN",      # type annotations
    "D",        # docstrings
    "PLC0415",  # import not at top-level (common in test fixtures)
    "SLF001",   # private member access (testing internals)
    "PT011",    # pytest.raises too broad
    "TRY003",   # long exception messages
    "EM101",    # exception string literal
    "ARG001",   # unused function argument
    "SIM117",   # nested with statements
    "PLW0108",  # lambda may be unnecessary
    "B017",     # assert blind exception (testing frozen dataclasses)
    "B007",     # unused loop variable (common in async for)
    "F841",     # unused local variable (trace context managers)
    "PERF401",  # async list comprehension (readability over perf in tests)
]
"__init__.py" = [
    "F401",     # unused imports (re-exports)
]
"src/saccade/primitives/projectors.py" = [
    "C901",     # complex function (inherent to projection logic)
    "PLR0912",  # too many branches
    "PLR0915",  # too many statements
]
"src/saccade/integrations/litellm/*.py" = [
    "C901",     # streaming has many branches by nature
    "SLF001",   # private member access (LiteLLM ModelResponse._usage)
    "ARG002",   # unused method argument (LiteLLM interface requires these)
    "PLC0415",  # import not at top-level (lazy import litellm in register())
]

[[tool.ty.overrides]]
include = ["src/saccade/integrations/litellm/*.py"]

[tool.ty.overrides.rules]
invalid-method-override = "ignore"

[[tool.ty.overrides]]
include = ["tests/unit/integrations/litellm/test_openai_provider.py"]

[tool.ty.overrides.rules]
unresolved-attribute = "ignore"
not-subscriptable = "ignore"

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
docstring-code-format = true

[tool.ty.terminal]
error-on-warning = true

[tool.ty.environment]
python-version = "3.13"

[tool.ty.rules]
possibly-unresolved-reference = "error"
unused-ignore-comment = "warn"

[tool.pytest.ini_options]
asyncio_mode = "auto"
asyncio_default_fixture_loop_scope = "function"
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
markers = [
    "unit: unit tests (isolated component tests)",
    "integration: integration tests (multi-component tests)",
    "e2e: end-to-end tests (full system tests)",
]
filterwarnings = [
    "ignore:Span has no TraceBus:RuntimeWarning",
    "ignore:coroutine 'Logging.async_success_handler' was never awaited:RuntimeWarning",
]
